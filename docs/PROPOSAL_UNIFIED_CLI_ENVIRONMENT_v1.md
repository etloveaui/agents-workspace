# 제안: 통합 CLI 에이전트 환경 v2

**문서 버전:** 1.0
**작성자:** Gemini (System Architect 페르소나)
**작성일:** 2025-09-03

## 1. Executive Summary

현재 워크스페이스는 `Claude Code`, `Codex CLI`, `Gemini CLI`라는 강력한 3개의 AI 에이전트를 사용하고 있으나, 각 도구의 설정, 컨텍스트 관리, 실행 방식이 파편화되어 있어 비효율적인 컨텍스트 전환 비용이 발생하고 있습니다.

본 문서는 이 문제를 해결하기 위해, **`npm scripts`를 중앙 허브(Hub)로 사용하는 경량 통합 환경**을 제안합니다. 이 환경은 기존 CLI 도구들을 수정하지 않으면서, 중앙 설정 파일과 컨텍스트 파일을 통해 모든 에이전트를 일관된 방식으로 제어하고 관리하는 것을 목표로 합니다. 이를 통해 개발자는 개별 도구의 복잡성에서 벗어나, 단일화된 워크플로우 안에서 작업 효율을 극대화할 수 있습니다.

---

## 2. 현황 분석 및 문제 정의

웹 검색 및 기존 `docs` 문서 분석 결과, 각 CLI 도구는 다음과 같은 특징과 문제점을 가집니다.

- **공통점:** 모두 `Node.js` 기반이며 `npm`으로 설치 가능하여, 기술 스택의 통일성을 갖추고 있습니다.
- **차이점 및 문제점:**
    1.  **파편화된 설정:** `Codex(TOML)`와 `Gemini/Claude(JSON)`는 서로 다른 설정 파일 형식을 사용하며, 각기 다른 위치에 저장됩니다.
    2.  **중복된 컨텍스트 관리:** 각 에이전트에게 동일한 지침을 제공하기 위해서는 `CLAUDE.md`, `codex.md` 등 여러 컨텍스트 파일을 수동으로 동기화해야 합니다.
    3.  **일관성 없는 실행 방식:** 각 CLI는 고유의 명령어와 옵션을 가지고 있어, 에이전트 전환 시 학습 곡선이 발생합니다.

---

## 3. 제안 아키텍처: Hub & Spoke 모델

이러한 문제를 해결하기 위해, `npm scripts`와 간단한 Node.js 헬퍼 스크립트를 **중앙 허브(Hub)**로 삼고, 개별 CLI 도구들을 **스포크(Spoke)**로 연결하는 'Hub & Spoke' 모델을 제안합니다.

![Hub and Spoke Diagram](https://i.imgur.com/rG4J4gB.png) <!--- A conceptual diagram would go here --->

-   **Hub (중앙 관리 계층):**
    -   `package.json`의 `scripts`
    -   새로 작성될 `scripts/unified-setup.js`
-   **Spokes (개별 도구 계층):**
    -   `@anthropic-ai/claude-code`
    -   `@openai/codex`
    -   `@google/gemini-cli`

---

## 4. 핵심 컴포넌트 및 사용자 워크플로우

### 4.1. 핵심 컴포넌트

1.  **`package.json` (통합 실행기):**
    -   `devDependencies`에 3개의 CLI 도구를 명시하여 `npm install`로 일괄 설치를 보장합니다.
    -   `scripts` 섹션에 다음과 같은 통합 명령어를 정의합니다.
        -   `setup`: 모든 환경 설정을 한번에 실행합니다.
        -   `config`: 중앙 설정 파일의 내용을 각 CLI에 맞게 배포합니다.
        -   `sync-context`: 중앙 컨텍스트 파일의 내용을 모든 CLI에 동기화합니다.
        -   `claude`, `codex`, `gemini`: 각 에이전트를 실행하는 단일화된 진입점 역할을 합니다.

2.  **`project.config.json` (중앙 설정 파일):**
    -   워크스페이스 루트에 생성될 이 파일은 각 CLI의 주요 설정을 통합하여 관리합니다. (예: 모델 버전, 승인 정책 등)

3.  **`CONTEXT.md` (중앙 컨텍스트 파일):**
    -   모든 에이전트에게 공통적으로 제공될 지침, 규칙, 원칙 등을 이 파일 한 곳에서 관리합니다.

4.  **`scripts/unified-setup.js` (헬퍼 스크립트):**
    -   `project.config.json`을 읽어 각 CLI가 요구하는 네이티브 설정 파일(`.toml`, `.json`)을 자동으로 생성하거나 업데이트합니다.
    -   `CONTEXT.md` 파일을 `CLAUDE.md`, `codex.md` 등으로 복사하여 컨텍스트를 동기화합니다.

### 4.2. 사용자 워크플로우

1.  **초기 설정:**
    -   새로운 개발자는 `git clone` 후, 단 두 개의 명령어를 실행합니다.
        1.  `npm install`
        2.  `npm run setup`

2.  **일상적인 작업:**
    -   일관된 `npm run` 명령어를 사용하여 원하는 에이전트를 실행합니다.
        ```bash
        # Claude 에이전트 실행
        npm run claude -- "이 코드 분석해줘"

        # Codex 에이전트 실행 (인자 전달)
        npm run codex -- --p "이 함수 리팩토링해줘"
        ```

3.  **설정 및 컨텍스트 변경:**
    -   `project.config.json` 또는 `CONTEXT.md` 파일만 수정한 후, `npm run config` 또는 `npm run sync-context`를 실행하여 모든 에이전트에 변경사항을 일괄 적용합니다.

---

## 5. 기대 효과

-   **효율성 증대:** 여러 설정 파일을 오가며 작업할 필요 없이, 중앙에서 모든 것을 관리하여 컨텍스트 전환 비용을 최소화합니다.
-   **일관성 확보:** 모든 에이전트가 동일한 컨텍스트와 설정을 공유하게 되어, 일관된 결과물을 기대할 수 있습니다.
-   **사용성 개선:** 신규 참여자가 `npm install` 및 `npm run setup` 만으로 즉시 프로젝트에 참여할 수 있는 'Zero-Setup'에 가까운 경험을 제공합니다.
-   **확장성:** 향후 새로운 CLI 에이전트가 추가되더라도, 헬퍼 스크립트에 로직을 추가하는 것만으로 쉽게 통합할 수 있습니다.

---

## 6. 결론

본 제안은 복잡한 시스템을 새로 구축하는 대신, 기존의 검증된 도구(`npm`)를 활용하여 현재 워크스페이스의 문제점을 가장 실용적이고 효율적인 방법으로 해결하는 데 초점을 맞춥니다. 이를 통해 우리는 파편화된 도구의 집합을, 시너지를 내는 **통합 에이전트 개발 환경**으로 발전시킬 수 있습니다.
